<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News | ASCRL</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/js/page-flip.browser.min.js"></script>
    <style>
        :root {
            --primary: #c00;
            --accent: #ff0;
            --bg-dark: #000;
            --card-bg: #0d0d0d;
            --border: #1a1a1a;
            --text-muted: #a0a0a0;
            --transition: 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        body { margin: 0; font-family: 'Arial Black', sans-serif; background: var(--bg-dark); color: #fff; overflow-x: hidden; }

        /* --- MODULAR NAVIGATION STYLES --- */
        #nav-placeholder { position: relative; z-index: 2000; }
        
        .nav-overlay { 
            position: fixed; top: 0; left: -100%; width: 100%; max-width: 350px; 
            height: 100vh; background: #050505; transition: left 0.5s ease; 
            z-index: 1999; padding-top: 100px; border-right: 1px solid var(--primary); 
        }
        .nav-overlay.open { left: 0; }
        .nav-links { display: flex; flex-direction: column; padding: 0 3rem; }
        .nav-links a { 
            color: #fff; text-decoration: none; font-size: 1.2rem; padding: 1.2rem 0; 
            border-bottom: 1px solid var(--border); transition: var(--transition); letter-spacing: 2px; 
        }
        .nav-links a:hover { color: var(--primary); padding-left: 10px; }

        /* --- HERO --- */
        .hero { 
            background: radial-gradient(circle at center, #222 0%, #000 100%); 
            padding: 12rem 1rem 8rem; 
            text-align: center; 
            border-bottom: 1px solid var(--border);
        }
        h1 { font-size: clamp(3rem, 10vw, 5rem); margin: 0; letter-spacing: -2px; line-height: 0.9; }
        .hero p { color: var(--primary); letter-spacing: 5px; text-transform: uppercase; font-size: 0.9rem; margin-top: 1rem; }
        
        .text-gradient {
            background: linear-gradient(to bottom, #fff 30%, #444 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* --- MAGAZINE LAYOUT --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 4rem 2rem; }

        .magazine-rack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: -4rem; /* Overlap into Hero */
            position: relative;
            z-index: 10;
        }

        .featured-issue {
            grid-column: 1 / -1; /* Full width for the newest issue */
            display: flex;
            background: var(--card-bg);
            border: 1px solid var(--primary);
            overflow: hidden;
            box-shadow: 0 0 30px rgba(204, 0, 0, 0.2);
            cursor: pointer;
            transition: var(--transition);
        }
        .featured-issue:hover { transform: translateY(-5px); }

        .issue-cover {
            width: 40%;
            object-fit: cover;
            border-right: 1px solid var(--border);
            transition: var(--transition);
        }

        .featured-issue:hover .issue-cover { transform: scale(1.02); }

        .issue-info {
            padding: 3rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: left;
        }

        .race-card {
            background: var(--card-bg);
            padding: 2rem;
            border: 1px solid var(--border);
            transition: var(--transition);
            text-align: left;
        }
        .race-card:hover { border-color: var(--primary); transform: translateY(-5px); }

        .stat-label { font-size: 0.7rem; color: var(--text-muted); letter-spacing: 2px; text-transform: uppercase; display: block; margin-bottom: 0.5rem; }
        .btn-primary { background: var(--primary); color: #fff; padding: 10px 20px; text-decoration: none; border: none; font-family: 'Arial Black'; cursor: pointer; letter-spacing: 1px; }

        /* --- READER OVERLAY --- */
        #reader-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 3000; display: none;
            flex-direction: column; align-items: center; justify-content: center;
            backdrop-filter: blur(10px);
        }

        .flipbook-container { 
            width: 90vw; height: 85vh; 
            max-width: 950px; display: flex; 
            justify-content: center; align-items: center; 
        }

        .page { background: #fff; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        .page img { width: 100%; height: 100%; object-fit: contain; }

        footer { padding: 4rem 1rem; text-align: center; border-top: 1px solid var(--border); color: #333; font-size: 0.8rem; letter-spacing: 2px; }

        @media (max-width: 768px) {
            .featured-issue { flex-direction: column; }
            .issue-cover { width: 100%; height: 300px; }
            .magazine-rack { margin-top: 2rem; }
            .issue-info { padding: 2rem; }
        }
    </style>
</head>
<body>

    <div id="nav-placeholder"></div>

    <header class="hero">
        <p>WEEKLY PRESS</p>
        <h1 class="text-gradient">ASCRL MAGAZINE</h1>
    </header>

    <main class="container">
        <div class="magazine-rack" id="magazine-grid"></div>
    </main>

    <div id="reader-overlay">
        <button class="btn-primary" style="position:fixed; top:2rem; right:2rem; z-index:3005;" onclick="closeReader()">CLOSE ISSUE ✕</button>
        <div id="reader-loading" style="color:var(--primary); font-family:'Arial Black'; margin-bottom: 1rem;">LOADING TELEMETRY...</div>
        <div class="flipbook-container" id="flipbook-root"></div>
    </div>

    <footer>© 2025-2026 AMERICAN STOCK CAR RACING LEAGUE</footer>

    <script>
        // --- 1. MODULAR NAVIGATION ---
        fetch('nav.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('nav-placeholder').innerHTML = data;
                
                const currentPage = window.location.pathname.split("/").pop() || "index.html";
                const navID = "nav-" + currentPage.split(".")[0];
                const activeLink = document.getElementById(navID);
                if (activeLink) {
                    activeLink.style.color = "var(--primary)";
                    activeLink.style.borderLeft = "4px solid var(--primary)";
                    activeLink.style.paddingLeft = "15px";
                }
            });

        function toggleMenu() { 
            const menu = document.getElementById('nav-menu');
            if (menu) menu.classList.toggle('open'); 
        }

       // --- 2. ARTICLE DATABASE ---
        const articles = [
            {
                title: "BACK-TO-BACK IN VEGAS",
                date: "NOV 15, 2025",
                tag: "VIDEO HIGHLIGHT",
                // IMPORTANT: Replace this preview with a screenshot of the video!
                preview: "https://raw.githubusercontent.com/mattwilson20/ascrl-website/fbfa579723c77e6fbf3d60eb03885f5e66f0d1d9/ascrp3.jpg",
                teaser: "Congrats to @HockeyDeckout for going back to back at Vegas! Watch the exclusive video coverage.",
                pages: [
                    // Corrected link to avoid 404 error
                    "https://raw.githubusercontent.com/mattwilson20/ascrl-website/main/VEGASASCRISSUE_-_Trim.mp4"
                ]
            },
            {
                title: "TEAMS EDITION",
                date: "NOV 13, 2025",
                tag: "ASCR WEEKLY #8",
                preview: "https://raw.githubusercontent.com/mattwilson20/ascrl-website/52a4a9654a523f74d2cc913c553e678a7fa387c7/ASCRweeklyissue8.jpg",
                teaser: "A fun and lighthearted look at the teams! Thanks to everyone who reached out with context to fill these pages.",
                pages: [
                    "https://raw.githubusercontent.com/mattwilson20/ascrl-website/52a4a9654a523f74d2cc913c553e678a7fa387c7/ASCRweeklyissue8.jpg",
                    "https://raw.githubusercontent.com/mattwilson20/ascrl-website/738345e5637e178e82ca96f516d783f01fb0268d/ASCRPage2.jpg",
                    "https://raw.githubusercontent.com/mattwilson20/ascrl-website/fbfa579723c77e6fbf3d60eb03885f5e66f0d1d9/ascrp3.jpg",
                    "https://raw.githubusercontent.com/mattwilson20/ascrl-website/7052e9039271786c89076e3ec430c84f27f20c11/ascrp4.jpg",
                    "https://raw.githubusercontent.com/mattwilson20/ascrl-website/52f9a743956628f894ed18cc68a7e1f7198311ca/ascrp5.jpg",
                    "https://raw.githubusercontent.com/mattwilson20/ascrl-website/b9af07f0f081c9ee4802009f20ed588339aa9b98/ascrp6.jpg",
                    "https://raw.githubusercontent.com/mattwilson20/ascrl-website/5097bc72fc757138a902981f441cf90e9882abe7/ascrp7.jpg"
                ]
            },
            {
                title: "HOCKEY DOMINATES VEGAS",
                date: "NOV 12, 2025",
                tag: "ASCR WEEKLY #7",
                preview: "https://github.com/mattwilson20/ascrl-website/blob/main/ASCRweeklyissue7.jpg?raw=true",
                teaser: "HockeyDeckout would NOT be denied at Vegas! Tons of green flag racing made this the most exciting race of the year.",
                pages: [
                    "https://github.com/mattwilson20/ascrl-website/blob/main/ASCRweeklyissue7.jpg?raw=true",
                    "HockeyDeckout would NOT be denied at Vegas!<br><br>With tons of green flag racing, Vegas stood out as the most exciting race of the year for ASCR.<br><br>Top drivers fought to stay on the lead lap, and others drove hard to get back to the front. In the end, it was an absolute clinic put on by Hockey."
                ]
            },
            {
                title: "VETERANS DAY TRIBUTE",
                date: "NOV 11, 2025",
                tag: "SPECIAL ISSUE",
                preview: "https://raw.githubusercontent.com/mattwilson20/ascrl-website/main/ASCRweeklyissue6.jpg",
                teaser: "A heartfelt tribute to our veterans ahead of the Las Vegas weekend, plus the official announcement of Backrow Motorsports.",
                pages: [
                    "https://raw.githubusercontent.com/mattwilson20/ascrl-website/main/ASCRweeklyissue6.jpg",
                    "https://raw.githubusercontent.com/mattwilson20/ascrl-website/main/ASCRPage2.jpg"
                ]
            },
            {
                title: "NACHO SCORES NASHVILLE",
                date: "NOV 11, 2025",
                tag: "RACE RECAP",
                preview: "https://raw.githubusercontent.com/mattwilson20/ascrl-website/0a91dc765fb2ed87e57acdc2ec06585197ce0f30/ASCRweeklyissue5.jpg",
                teaser: "Eight races, eight different winners! Singular_Nacho becomes the latest first-time victor in an incredible display of parity.",
                pages: ["https://raw.githubusercontent.com/mattwilson20/ascrl-website/0a91dc765fb2ed87e57acdc2ec06585197ce0f30/ASCRweeklyissue5.jpg"]
            },
            {
                title: "HOMETOWN FAVORITE",
                date: "NOV 10, 2025",
                tag: "DRIVER SPOTLIGHT",
                preview: "https://raw.githubusercontent.com/mattwilson20/ascrl-website/7654906eeda55824349300cf0fe1b8cddf32f9c0/ASCRweeklyissue4.jpg",
                teaser: "The Tennessee native carries the hopes of the home crowd. Can Dewshine finally break through?",
                pages: ["https://raw.githubusercontent.com/mattwilson20/ascrl-website/7654906eeda55824349300cf0fe1b8cddf32f9c0/ASCRweeklyissue4.jpg"]
            },
            {
                title: "KEVWOOD WINS ARCA OPENER",
                date: "NOV 09, 2025",
                tag: "ASCR WEEKLY #3",
                preview: "https://github.com/mattwilson20/ascrl-website/blob/main/ASCRweeklyissue3.jpg?raw=true",
                teaser: "kevwood87 made his first career start with ASCR and showed the league he is a force to be reckoned with.",
                pages: [
                    "https://github.com/mattwilson20/ascrl-website/blob/main/ASCRweeklyissue3.jpg?raw=true",
                    "kevwood87 made his first career start with ASCR and showed the league he is a force to be reckoned with.<br><br>The ARCA opener saw some dirt guys come over for a little asphalt racing.<br><br>Congrats Kev on the win and being on the cover of this issue of the newsletter!"
                ]
            },
            {
                title: "PRESEASON OPENER",
                date: "NOV 09, 2025",
                tag: "RACE PREVIEW",
                preview: "https://github.com/mattwilson20/ascrl-website/blob/main/ASCRweeklyissue2.jpg?raw=true",
                teaser: "Looking to be a small field at Phoenix for the preseason opener, but the competition will be fierce.",
                pages: [
                    "https://github.com/mattwilson20/ascrl-website/blob/main/ASCRweeklyissue2.jpg?raw=true"
                ]
            },
            {
                title: "ASCR WEEKLY ISSUE #1",
                date: "NOV 07, 2025",
                tag: "COVER STORY",
                preview: "https://github.com/mattwilson20/ascrl-website/blob/main/big-fella-atlanta-win.jpg?raw=true",
                teaser: "BIG_FELLAx2220 takes the win at Atlanta! A special look at the very first cover of ASCR Weekly.",
                pages: [
                    "https://github.com/mattwilson20/ascrl-website/blob/main/big-fella-atlanta-win.jpg?raw=true",
                    "BIG_FELLAx2220, I didn’t feel right giving you a half-assed magazine cover after a win like that.<br><br>I needed some practice so I can really nail down the format/style of the newsletter.<br><br>Congrats on being the cover of ASCR Weekly Issue #1!"
                ]
            }
        ];

        // --- 3. RENDER LOGIC ---
        function initNews() {
            const grid = document.getElementById('magazine-grid');
            grid.innerHTML = articles.map((art, i) => {
                // First item is the Featured Banner
                if(i === 0) {
                    return `
                        <div class="featured-issue" onclick="openReader(${i})">
                            <img src="${art.preview}" class="issue-cover">
                            <div class="issue-info">
                                <span class="stat-label" style="color:var(--primary)">LATEST EDITION // ${art.date}</span>
                                <h2 style="font-size:2.5rem; margin:1rem 0; line-height:1;">${art.title}</h2>
                                <p style="color:var(--text-muted); margin-bottom:2rem; font-family:sans-serif; line-height:1.5;">${art.teaser}</p>
                                <span class="btn-primary" style="width:fit-content">READ MAGAZINE</span>
                            </div>
                        </div>
                    `;
                }
                // Other items are grid cards
                return `
                    <div class="race-card" onclick="openReader(${i})" style="cursor:pointer">
                        <span class="stat-label">${art.tag}</span>
                        <h3 style="margin:1rem 0; font-size:1.2rem;">${art.title}</h3>
                        <img src="${art.preview}" style="width:100%; border-radius:4px; margin-bottom:1rem; border:1px solid #333;">
                        <span class="stat-label" style="color:var(--primary); cursor:pointer;">OPEN ISSUE →</span>
                    </div>
                `;
            }).join('');
        }

        // --- 4. FLIPBOOK LOGIC (FIXED FOR VIDEO) ---
        let flipBook = null;

        function openReader(idx) {
            const overlay = document.getElementById('reader-overlay');
            const root = document.getElementById('flipbook-root');
            
            overlay.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Stop background scrolling

            // Setup HTML structure for pages
            root.innerHTML = `<div id="book-el">
                ${articles[idx].pages.map(content => {
                    
                    // 1. CHECK FOR DIRECT VIDEO FILE (MP4, WEBM)
                    if (content.endsWith('.mp4') || content.endsWith('.webm')) {
                        return `
                            <div class="page" style="background:#000; display:flex; align-items:center; justify-content:center;">
                                <video controls playsinline style="width:100%; height:100%; object-fit:contain;">
                                    <source src="${content}" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>
                            </div>`;
                    }

                    // 2. CHECK FOR IMAGE (Standard http links that aren't videos)
                    else if (content.startsWith('http')) {
                        return `<div class="page"><img src="${content}"></div>`;
                    } 

                    // 3. FALLBACK TO TEXT
                    else {
                        return `<div class="page" style="padding:20px; color:black; display:flex; align-items:center; justify-content:center; text-align:center;">
                                    <p style="font-family:sans-serif; font-size:1.2rem;">${content}</p>
                                </div>`;
                    }
                }).join('')}
            </div>`;

            // Initialize PageFlip Library
            setTimeout(() => {
                const el = document.getElementById('book-el');
                flipBook = new St.PageFlip(el, {
                    width: 500, height: 650,
                    size: "stretch", minWidth: 315, maxWidth: 950,
                    showCover: articles[idx].pages.length > 1, 
                    drawShadow: true
                });
                
                flipBook.loadFromHTML(el.querySelectorAll('.page'));
                document.getElementById('reader-loading').style.display = 'none';
            }, 300);
        }

        function closeReader() {
            document.getElementById('reader-overlay').style.display = 'none';
            document.body.style.overflow = 'auto'; // Restore scrolling
            if (flipBook) flipBook.destroy();
            document.getElementById('reader-loading').style.display = 'block';
        }

        initNews();
    </script>
</body>
</html>
