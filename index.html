<script>
        // 1. NAVIGATION FETCH
        fetch('nav.html')
            .then(response => {
                if (!response.ok) throw new Error('Nav file missing');
                return response.text();
            })
            .then(data => {
                document.getElementById('nav-placeholder').innerHTML = data;
                const currentPage = window.location.pathname.split("/").pop() || "index.html";
                const navID = "nav-" + currentPage.split(".")[0];
                const activeLink = document.getElementById(navID);
                if (activeLink) {
                    activeLink.style.color = "var(--primary)";
                    activeLink.style.borderLeft = "4px solid var(--primary)";
                    activeLink.style.paddingLeft = "15px";
                }
            })
            .catch(err => console.error("Navigation error:", err));

        function toggleMenu() { 
            const menu = document.getElementById('nav-menu');
            if (menu) menu.classList.toggle('open'); 
        }

        // 2. DASHBOARD LOGIC (SCHEDULE & STANDINGS)
        
        // Timer Helper
        function startTimer(id, target) {
            const el = document.getElementById(id);
            if (!el) return;
            const update = () => {
                const now = new Date();
                const diff = target - now;
                if (diff <= 0) { el.textContent = "RACE DAY"; el.style.color = "var(--accent)"; return; }
                const d = Math.floor(diff / 86400000);
                const h = Math.floor((diff % 86400000) / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                el.textContent = `${d}D ${h}H ${m}M`;
            };
            update();
            setInterval(update, 60000);
        }

        // Fetch Schedule
        // NOTE: Ensure your file is named exactly 'schedule.json' (all lowercase) on GitHub
        fetch('schedule.json')
            .then(r => r.json())
            .then(data => {
                ['Cup', 'Xfinity', 'Truck', 'Menards'].forEach(series => {
                    const idPrefix = series.toLowerCase();
                    const now = new Date();
                    now.setHours(0,0,0,0); // Set to start of today

                    const nextRace = data[series]?.find(r => new Date(r.date) >= now);

                    if (nextRace) {
                        document.getElementById(`${idPrefix}-next`).textContent = nextRace.track;
                        startTimer(`${idPrefix}-timer`, new Date(nextRace.date + 'T20:00:00'));
                    } else {
                        document.getElementById(`${idPrefix}-next`).textContent = "SEASON COMPLETE";
                        document.getElementById(`${idPrefix}-timer`).textContent = "OFF-SEASON";
                    }
                });
            })
            .catch(err => {
                console.error("Schedule load error. Check if schedule.json exists and is lowercase:", err);
            });

        // Fetch Standings
        // NOTE: Ensure your file is named exactly 'standings.json' (all lowercase) on GitHub
        fetch('standings.json')
            .then(r => r.json())
            .then(data => {
                const grid = document.getElementById('leaders-grid');
                const seriesList = ['Cup', 'Xfinity', 'Truck', 'Menards'];
                
                let html = '';
                seriesList.forEach(s => {
                    if (data[s] && data[s][0]) {
                        const leader = data[s][0];
                        html += `
                            <div class="stat-box">
                                <span class="stat-label">${s.toUpperCase()} LEADER</span>
                                <span class="stat-value" style="color:white; display:block; margin: 0.5rem 0;">${leader.driver}</span>
                                <span class="stat-label" style="color:var(--primary)">${leader.points} PTS</span>
                            </div>
                        `;
                    }
                });
                grid.innerHTML = html;
            })
            .catch(err => {
                console.error("Standings load error. Check if standings.json exists and is lowercase:", err);
            });
    </script>
